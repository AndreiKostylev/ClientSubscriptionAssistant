<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ClientSubscriptionAssistant.Views.SubscriptionPage"
             Title="ĞœĞ¾Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸">

    <RefreshView IsRefreshing="{Binding IsBusy}"
                 Command="{Binding RefreshCommand}">

        <ScrollView>
            <VerticalStackLayout Spacing="15" Padding="15">

          
                <Grid ColumnDefinitions="*,auto">
                    <Label Text="ĞœĞ¾Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸"
                           FontSize="24"
                           FontAttributes="Bold"
                           VerticalOptions="Center"/>

                    <Button Text="â† ĞĞ°Ğ·Ğ°Ğ´"
                            BackgroundColor="Gray"
                            TextColor="White"
                            CornerRadius="10"
                            Padding="10,5"
                            Grid.Column="1"
                            Command="{Binding NavigateToMainCommand}"/>
                </Grid>

      
                <Frame BackgroundColor="LightBlue"
                       CornerRadius="10"
                       Padding="15">
                    <VerticalStackLayout Spacing="10">
                        <HorizontalStackLayout HorizontalOptions="Center" Spacing="30">
                            <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                                <Label Text="{Binding Subscriptions.Count, StringFormat='{0}'}"
                                       FontSize="24"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"/>
                                <Label Text="ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ğº"
                                       FontSize="12"
                                       HorizontalOptions="Center"/>
                            </VerticalStackLayout>

                            <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                                <Label Text="{Binding TotalMonthlyCost, StringFormat='{0:C}'}"
                                       FontSize="24"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"/>
                                <Label Text="Ğ’ Ğ¼ĞµÑÑÑ†"
                                       FontSize="12"
                                       HorizontalOptions="Center"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <Frame BackgroundColor="White"
                       CornerRadius="10"
                       Padding="15"
                       HasShadow="True">

                    <VerticalStackLayout Spacing="10">
                        <Label Text="Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€:"
                               FontSize="16"
                               FontAttributes="Bold"/>

                        <HorizontalStackLayout Spacing="10">
                            <Button Text="Ğ’ÑĞµ"
                                    BackgroundColor="{Binding AllFilterColor}"
                                    TextColor="White"
                                    CornerRadius="8"
                                    Padding="15,8"
                                    Command="{Binding FilterAllCommand}"/>

                            <Button Text="ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ"
                                    BackgroundColor="{Binding ActiveFilterColor}"
                                    TextColor="White"
                                    CornerRadius="8"
                                    Padding="15,8"
                                    Command="{Binding FilterActiveCommand}"/>

                            <Button Text="ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ"
                                    BackgroundColor="{Binding InactiveFilterColor}"
                                    TextColor="White"
                                    CornerRadius="8"
                                    Padding="15,8"
                                    Command="{Binding FilterInactiveCommand}"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>

                </Frame>

                <Frame BackgroundColor="White"
                       CornerRadius="10"
                       Padding="15"
                       HasShadow="True">

                    <Button Text="â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ"
                            BackgroundColor="#28A745"
                            TextColor="White"
                            FontSize="16"
                            CornerRadius="10"
                            Padding="20,12"
                            Command="{Binding ShowAddFormCommand}"/>

                </Frame>

   
                <Frame BackgroundColor="White"
                       CornerRadius="10"
                       Padding="15"
                       HasShadow="True"
                       IsVisible="{Binding ShowAddForm}">

                    <VerticalStackLayout Spacing="15">

                        <Label Text="Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ"
                               FontSize="18"
                               FontAttributes="Bold"/>

              
                        <VerticalStackLayout Spacing="5">
                            <Label Text="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ *" FontSize="14"/>
                            <Entry Placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Netflix Premium"
                                   Text="{Binding NewSubscriptionName}"/>
                        </VerticalStackLayout>

           
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Ğ¦ĞµĞ½Ğ° (â‚½) *" FontSize="14"/>
                            <Entry Placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 599"
                                   Text="{Binding NewSubscriptionPrice}"
                                   Keyboard="Numeric"/>
                        </VerticalStackLayout>

                       
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Ğ”Ğ°Ñ‚Ğ° Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° *" FontSize="14"/>
                            <DatePicker Date="{Binding NewSubscriptionStartDate}"
                                        Format="dd.MM.yyyy"/>
                        </VerticalStackLayout>

                       
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Ğ¦Ğ¸ĞºĞ» Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ *" FontSize="14"/>
                            <Picker SelectedItem="{Binding NewSubscriptionBillingCycle}">
                                <Picker.ItemsSource>
                                    <x:Array Type="{x:Type x:String}">
                                        <x:String>monthly</x:String>
                                        <x:String>yearly</x:String>
                                    </x:Array>
                                </Picker.ItemsSource>
                            </Picker>
                        </VerticalStackLayout>

      
                        <VerticalStackLayout Spacing="5">
                            <Label Text="ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ *" FontSize="14"/>
                            <Picker Title="Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ"
                                    ItemsSource="{Binding Categories}"
                                    SelectedItem="{Binding SelectedCategory}"
                                    ItemDisplayBinding="{Binding Name}"/>
                        </VerticalStackLayout>

            
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Ğ¡ĞµÑ€Ğ²Ğ¸Ñ *" FontSize="14"/>
                            <Picker Title="Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞµÑ€Ğ²Ğ¸Ñ"
                                    ItemsSource="{Binding Services}"
                                    SelectedItem="{Binding SelectedService}"
                                    ItemDisplayBinding="{Binding Name}"/>
                        </VerticalStackLayout>

                    
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="10">

                            <Button Text="ĞÑ‚Ğ¼ĞµĞ½Ğ°"
                                    BackgroundColor="Gray"
                                    TextColor="White"
                                    FontSize="16"
                                    CornerRadius="10"
                                    Padding="15,10"
                                    Command="{Binding HideAddFormCommand}"/>

                            <Button Text="Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ"
                                    BackgroundColor="#28A745"
                                    TextColor="White"
                                    FontSize="16"
                                    CornerRadius="10"
                                    Padding="15,10"
                                    Grid.Column="1"
                                    Command="{Binding AddSubscriptionCommand}"/>

                        </Grid>

                    </VerticalStackLayout>

                </Frame>

       
                <Frame BackgroundColor="White"
                       CornerRadius="10"
                       Padding="0"
                       HasShadow="True">

                    <CollectionView ItemsSource="{Binding Subscriptions}"
                                    SelectionMode="Single"
                                    SelectionChanged="OnSubscriptionSelected">

                        <CollectionView.EmptyView>
                            <VerticalStackLayout HorizontalOptions="Center" 
                                                 VerticalOptions="Center"
                                                 Padding="40"
                                                 Spacing="15">
                                <Label Text="ğŸ“­" 
                                       FontSize="50"
                                       HorizontalOptions="Center"/>
                                <Label Text="ĞĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ğº" 
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"/>
                                <Label Text="Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ ÑĞ²Ğ¾Ñ Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ" 
                                       FontSize="14"
                                       TextColor="Gray"
                                       HorizontalOptions="Center"/>
                            </VerticalStackLayout>
                        </CollectionView.EmptyView>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#F8F9FA"
                                       CornerRadius="10"
                                       Padding="15"
                                       Margin="10,5,10,5"
                                       HasShadow="False">

                                    <Grid ColumnDefinitions="auto,*,auto" ColumnSpacing="15">

                                       
                                        <Frame Grid.Column="0"
                                               WidthRequest="40"
                                               HeightRequest="40"
                                               CornerRadius="8"
                                               BackgroundColor="#28A745"
                                               Padding="0"
                                               IsVisible="{Binding IsActive}">
                                            <Label Text="âœ“"
                                                   FontSize="16"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center"/>
                                        </Frame>

                                        <Frame Grid.Column="0"
                                               WidthRequest="40"
                                               HeightRequest="40"
                                               CornerRadius="8"
                                               BackgroundColor="#6C757D"
                                               Padding="0"
                                               IsVisible="{Binding IsActive, Converter={x:StaticResource InvertBoolConverter}}">
                                            <Label Text="âœ•"
                                                   FontSize="16"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center"/>
                                        </Frame>

                                   
                                        <VerticalStackLayout Grid.Column="1" Spacing="5">
                                            <Label Text="{Binding Name}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"/>

                                            <Label Text="{Binding Service.Name, StringFormat='Ğ¡ĞµÑ€Ğ²Ğ¸Ñ: {0}'}"
                                                   FontSize="14"
                                                   TextColor="#666"/>

                                            <Label Text="{Binding Category.Name, StringFormat='ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ: {0}'}"
                                                   FontSize="12"
                                                   TextColor="#888"/>

                                            <Label Text="{Binding NextPaymentDate, StringFormat='Ğ¡Ğ»ĞµĞ´. Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ°: {0:dd.MM.yyyy}'}"
                                                   FontSize="11"
                                                   TextColor="#999"/>
                                        </VerticalStackLayout>

                                      
                                        <VerticalStackLayout Grid.Column="2" Spacing="5">
                                            <Label Text="{Binding Price, StringFormat='{0:C}'}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   TextColor="#007ACC"/>

                                            <Grid ColumnDefinitions="*,*" ColumnSpacing="5">
                                                <Button Text="âœ•"
                                                        BackgroundColor="#DC3545"
                                                        TextColor="White"
                                                        FontSize="12"
                                                        CornerRadius="5"
                                                        Padding="8,4"
                                                        Clicked="OnDeleteClicked"/>

                                                <Button Text="â¸"
                                                        BackgroundColor="#FFC107"
                                                        TextColor="Black"
                                                        FontSize="12"
                                                        CornerRadius="5"
                                                        Padding="8,4"
                                                        Grid.Column="1"
                                                        IsVisible="{Binding IsActive}"
                                                        Clicked="OnDeactivateClicked"/>
                                            </Grid>
                                        </VerticalStackLayout>

                                    </Grid>

                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>

                    </CollectionView>

                </Frame>

            </VerticalStackLayout>
        </ScrollView>

    </RefreshView>

</ContentPage>